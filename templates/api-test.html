<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIæµ‹è¯•é¡µé¢ - æ•°æ®å¯è§†åŒ–å¹³å°</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <style>
        .api-test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-form {
            display: grid;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 500;
            margin-bottom: 5px;
            color: #333;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group textarea {
            min-height: 200px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .response-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        
        .response-section h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .response-content {
            background: white;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .status-success {
            border-left-color: #28a745;
        }
        
        .status-error {
            border-left-color: #dc3545;
        }
        
        .chart-preview {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 20px;
        }
        
        .preset-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .preset-btn {
            padding: 5px 10px;
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .preset-btn:hover {
            background: #dee2e6;
        }
    </style>
</head>
<body>
    <div class="api-test-container">
        <h1>ğŸ“Š APIæµ‹è¯•é¡µé¢</h1>
        <p>æµ‹è¯•å›¾è¡¨ç»„ä»¶çš„POST APIæ¥å£ï¼Œæ”¯æŒå®æ—¶æ•°æ®æ›´æ–°</p>
        
        <div class="test-section">
            <h2>ğŸ”§ APIæµ‹è¯•é…ç½®</h2>
            
            <div class="preset-buttons">
                <button class="preset-btn" onclick="loadPreset('line')">æŠ˜çº¿å›¾ç¤ºä¾‹</button>
                <button class="preset-btn" onclick="loadPreset('bar')">æŸ±çŠ¶å›¾ç¤ºä¾‹</button>
                <button class="preset-btn" onclick="loadPreset('pie')">é¥¼å›¾ç¤ºä¾‹</button>
                <button class="preset-btn" onclick="loadPreset('scatter')">æ•£ç‚¹å›¾ç¤ºä¾‹</button>
                <button class="preset-btn" onclick="loadPreset('radar')">é›·è¾¾å›¾ç¤ºä¾‹</button>
                <button class="preset-btn" onclick="loadPreset('gauge')">ä»ªè¡¨ç›˜ç¤ºä¾‹</button>
            </div>
            
            <form class="test-form" id="apiTestForm">
                <div class="form-group">
                    <label for="componentId">ç»„ä»¶ID:</label>
                    <input type="text" id="componentId" value="line_basic_001" placeholder="è¾“å…¥ç»„ä»¶ID">
                </div>
                
                <div class="form-group">
                    <label for="requestData">è¯·æ±‚æ•°æ® (JSON):</label>
                    <textarea id="requestData" placeholder="è¾“å…¥JSONæ ¼å¼çš„è¯·æ±‚æ•°æ®"></textarea>
                </div>
                
                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testApi()">ğŸ§ª æµ‹è¯•API</button>
                    <button type="button" class="btn btn-secondary" onclick="clearResponse()">ğŸ—‘ï¸ æ¸…ç©ºå“åº”</button>
                    <button type="button" class="btn btn-secondary" onclick="copyRequest()">ğŸ“‹ å¤åˆ¶è¯·æ±‚</button>
                </div>
            </form>
            
            <div class="response-section" id="responseSection" style="display: none;">
                <h4>ğŸ“¤ APIå“åº”</h4>
                <div class="response-content" id="responseContent"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ˆ å›¾è¡¨é¢„è§ˆ</h2>
            <div id="chartPreview" class="chart-preview"></div>
        </div>
    </div>

    <!-- å¼•å…¥ä¾èµ– -->
    <script src="/static/js/echarts.js"></script>
    <script src="/static/js/DashboardEditor.js"></script>
    
    <script>
        let chartInstance = null;
        
        // é¢„è®¾æ•°æ®
        const presets = {
            line: {
                data: {
                    title: {
                        text: "é”€å”®è¶‹åŠ¿åˆ†æ",
                        left: "center"
                    },
                    tooltip: {
                        trigger: "axis"
                    },
                    legend: {
                        data: ["é”€å”®é¢", "åˆ©æ¶¦"]
                    },
                    xAxis: {
                        type: "category",
                        data: ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ"]
                    },
                    yAxis: {
                        type: "value"
                    },
                    series: [
                        {
                            name: "é”€å”®é¢",
                            type: "line",
                            data: [120, 132, 101, 134, 90, 230],
                            smooth: true
                        },
                        {
                            name: "åˆ©æ¶¦",
                            type: "line",
                            data: [60, 66, 50, 67, 45, 115],
                            smooth: true
                        }
                    ]
                },
                options: {
                    animation: true,
                    theme: "default"
                }
            },
            bar: {
                data: {
                    title: {
                        text: "æœˆåº¦é”€å”®ç»Ÿè®¡",
                        left: "center"
                    },
                    tooltip: {
                        trigger: "axis"
                    },
                    legend: {
                        data: ["Q1", "Q2"]
                    },
                    xAxis: {
                        type: "category",
                        data: ["åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·", "æ·±åœ³", "æ­å·", "æˆéƒ½"]
                    },
                    yAxis: {
                        type: "value"
                    },
                    series: [
                        {
                            name: "Q1",
                            type: "bar",
                            data: [120, 200, 150, 80, 70, 110]
                        },
                        {
                            name: "Q2",
                            type: "bar",
                            data: [132, 180, 160, 90, 80, 120]
                        }
                    ]
                },
                options: {
                    animation: true,
                    theme: "default"
                }
            },
            pie: {
                data: {
                    title: {
                        text: "å¸‚åœºä»½é¢åˆ†å¸ƒ",
                        left: "center"
                    },
                    tooltip: {
                        trigger: "item",
                        formatter: "{a} <br/>{b}: {c} ({d}%)"
                    },
                    legend: {
                        orient: "vertical",
                        left: "left"
                    },
                    series: [
                        {
                            name: "è®¿é—®æ¥æº",
                            type: "pie",
                            radius: "50%",
                            data: [
                                {"value": 1048, "name": "æœç´¢å¼•æ“"},
                                {"value": 735, "name": "ç›´æ¥è®¿é—®"},
                                {"value": 580, "name": "é‚®ä»¶è¥é”€"},
                                {"value": 484, "name": "è”ç›Ÿå¹¿å‘Š"},
                                {"value": 300, "name": "è§†é¢‘å¹¿å‘Š"}
                            ]
                        }
                    ]
                },
                options: {
                    animation: true,
                    theme: "default"
                }
            },
            scatter: {
                data: {
                    title: {
                        text: "èº«é«˜ä½“é‡å…³ç³»åˆ†æ",
                        left: "center"
                    },
                    tooltip: {
                        trigger: "item"
                    },
                    xAxis: {
                        type: "value",
                        name: "èº«é«˜ (cm)"
                    },
                    yAxis: {
                        type: "value",
                        name: "ä½“é‡ (kg)"
                    },
                    series: [
                        {
                            name: "ç”·æ€§",
                            type: "scatter",
                            data: [
                                [170, 65], [175, 70], [180, 75], [185, 80], [190, 85],
                                [165, 60], [172, 68], [178, 72], [182, 78], [188, 82]
                            ],
                            symbolSize: 8
                        },
                        {
                            name: "å¥³æ€§",
                            type: "scatter",
                            data: [
                                [160, 50], [165, 55], [170, 60], [175, 65], [180, 70],
                                [155, 45], [162, 52], [168, 58], [173, 63], [178, 68]
                            ],
                            symbolSize: 8
                        }
                    ]
                },
                options: {
                    animation: true,
                    theme: "default"
                }
            },
            radar: {
                data: {
                    title: {
                        text: "èƒ½åŠ›è¯„ä¼°é›·è¾¾å›¾",
                        left: "center"
                    },
                    tooltip: {},
                    legend: {
                        data: ["é¢„ç®—åˆ†é…", "å®é™…å¼€é”€"]
                    },
                    radar: {
                        indicator: [
                            {"name": "é”€å”®", "max": 6500},
                            {"name": "ç®¡ç†", "max": 16000},
                            {"name": "ä¿¡æ¯æŠ€æœ¯", "max": 30000},
                            {"name": "å®¢æœ", "max": 38000},
                            {"name": "ç ”å‘", "max": 52000},
                            {"name": "å¸‚åœº", "max": 25000}
                        ]
                    },
                    series: [
                        {
                            name: "é¢„ç®—åˆ†é…",
                            type: "radar",
                            data: [
                                {
                                    value: [4200, 3000, 20000, 35000, 50000, 18000],
                                    name: "é¢„ç®—åˆ†é…"
                                }
                            ]
                        },
                        {
                            name: "å®é™…å¼€é”€",
                            type: "radar",
                            data: [
                                {
                                    value: [5000, 14000, 28000, 26000, 42000, 21000],
                                    name: "å®é™…å¼€é”€"
                                }
                            ]
                        }
                    ]
                },
                options: {
                    animation: true,
                    theme: "default"
                }
            },
            gauge: {
                data: {
                    title: {
                        text: "ç³»ç»Ÿæ€§èƒ½ç›‘æ§",
                        left: "center"
                    },
                    tooltip: {
                        formatter: "{a} <br/>{b} : {c}%"
                    },
                    series: [
                        {
                            name: "CPUä½¿ç”¨ç‡",
                            type: "gauge",
                            detail: {
                                formatter: "{value}%"
                            },
                            data: [
                                {
                                    value: 50,
                                    name: "CPU"
                                }
                            ]
                        }
                    ]
                },
                options: {
                    animation: true,
                    theme: "default"
                }
            }
        };
        
        // åŠ è½½é¢„è®¾æ•°æ®
        function loadPreset(type) {
            const preset = presets[type];
            if (preset) {
                document.getElementById('requestData').value = JSON.stringify(preset, null, 2);
            }
        }
        
        // æµ‹è¯•API
        async function testApi() {
            const componentId = document.getElementById('componentId').value;
            const requestDataText = document.getElementById('requestData').value;
            
            if (!componentId) {
                alert('è¯·è¾“å…¥ç»„ä»¶ID');
                return;
            }
            
            if (!requestDataText) {
                alert('è¯·è¾“å…¥è¯·æ±‚æ•°æ®');
                return;
            }
            
            let requestData;
            try {
                requestData = JSON.parse(requestDataText);
            } catch (e) {
                alert('è¯·æ±‚æ•°æ®æ ¼å¼é”™è¯¯ï¼š' + e.message);
                return;
            }
            
            try {
                const response = await fetch(`/api/components/${componentId}/data`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                // æ˜¾ç¤ºå“åº”
                showResponse(result, response.ok);
                
                // å¦‚æœæˆåŠŸï¼Œæ›´æ–°å›¾è¡¨é¢„è§ˆ
                if (result.success && result.data) {
                    updateChartPreview(result.data);
                }
                
            } catch (error) {
                showResponse({
                    success: false,
                    error: error.message,
                    timestamp: new Date().toISOString()
                }, false);
            }
        }
        
        // æ˜¾ç¤ºå“åº”
        function showResponse(data, success) {
            const responseSection = document.getElementById('responseSection');
            const responseContent = document.getElementById('responseContent');
            
            responseSection.style.display = 'block';
            responseSection.className = `response-section ${success ? 'status-success' : 'status-error'}`;
            responseContent.textContent = JSON.stringify(data, null, 2);
        }
        
        // æ¸…ç©ºå“åº”
        function clearResponse() {
            document.getElementById('responseSection').style.display = 'none';
        }
        
        // å¤åˆ¶è¯·æ±‚
        function copyRequest() {
            const requestData = document.getElementById('requestData').value;
            navigator.clipboard.writeText(requestData).then(() => {
                alert('è¯·æ±‚æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            });
        }
        
        // æ›´æ–°å›¾è¡¨é¢„è§ˆ
        function updateChartPreview(data) {
            const container = document.getElementById('chartPreview');
            
            // é”€æ¯æ—§å®ä¾‹
            if (chartInstance) {
                chartInstance.dispose();
            }
            
            // åˆ›å»ºæ–°å®ä¾‹
            chartInstance = echarts.init(container);
            chartInstance.setOption(data, true, true);
            
            // å“åº”å¼è°ƒæ•´
            window.addEventListener('resize', () => {
                if (chartInstance) {
                    chartInstance.resize();
                }
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // åŠ è½½é»˜è®¤é¢„è®¾
            loadPreset('line');
        });
    </script>
</body>
</html>
